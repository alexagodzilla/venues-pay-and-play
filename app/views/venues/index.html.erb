<div id="map" style="width: 100%; height: 400px;"
  data-controller="map"
  data-map-markers-value="<%= @markers.to_json %>"
  data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
</div>
<!--
<%= form_with(url: root_path, method: :get) do |f| %>
  <%= label_tag :size_of_band, "Size of Band" %>
  <%= range_field_tag :size_of_band, params[:size_of_band] %>
  <%= label_tag :price, "Price" %>
  <%= range_field_tag :price, params[:price] %>
  <%= submit_tag "Search" %>
<% end %>
-->

<%= form_with url: venues_path, method: :get, class: "d-flex" do %>
  <%= text_field_tag :query,
    params[:query],
    class: "form-control",
    placeholder: "Minimum number of musicians"
  %>
  <%= text_field_tag :query,
    params[:query],
    class: "form-control",
    placeholder: "Maximum number of musicians"
  %>
  <%= text_field_tag :query,
    params[:query],
    class: "form-control",
    placeholder: "Min price"
  %>
  <%= text_field_tag :query,
    params[:query],
    class: "form-control",
    placeholder: "Max price"
  %>
  <%= submit_tag "Search", class: "btn btn-primary" %>
<% end %>

<div class="container">
  <div class="row">
    <form>
      <div class="col-2 mt-4">
        <label for="start" class=""><strong>Start date</strong></label>
        <input class="form-control my-2" id="start" name="start" type="date">
      </div>
      <div class="col-2 mt-4">
        <label for="end"><strong>End date</strong></label>
        <input class="form-control my-2" id="end" name="end" type="date">
      </div>
      <div class="col-2 mt-4">
        <label for="min-price"><strong>Min price</strong></label>
        <input class="form-control my-2" id="min-price" name="minprice" type="text">
      </div>
      <div class="col-2 mt-4">
        <label for="max-price"><strong>Max price</strong></label>
        <input class="form-control my-2" id="max-price" name="maxprice" type="text">
      </div>
      <div class="col-2 mt-4">
        <label for="min-members"><strong>Min band members</strong></label>
        <input class="form-control my-2" id="min-members" name="minmembers" type="text">
      </div>
      <div class="col-2 mt-4">
        <label for="max-members"><strong>Max band members</strong></label>
        <input class="form-control my-2" id="max-members" name="maxmembers" type="text">
      </div>
      <div class="col-2 mt-4">
        <button class="btn btn-success mt-2" type="submit">Search</button>
      </div>
    </form>
  </div>
  <div class="row my-5 .d-flex justify-content-center">
    <% @venues.each do |venue| %>
      <div class="col-1 my-3">
        <div class="card h-100" style="width: 18rem;">
        <%= link_to venue_path(venue) do %>
          <% if venue.photo.attached? %>
            <%= cl_image_tag(venue.photo.key, width: 287, height: 150, crop: :thumb, gravity: :face, radius: 5) %>
          <% else %>
            <%= image_tag(venue.pic_url, width: 287, height: 150, crop: :thumb, gravity: :face, radius: 5) %>
          <% end %>
        <% end %>
          <div class="card-body d-flex flex-column">
            <h5 class="card-title"><strong><%= link_to venue.name, venue_path(venue.id), class: "text-dark" %></strong></h5>
            <p class="card-text"><%= venue.location %></p>
            <p class="card-text mt-auto"><strong>£<%= venue.price_per_day %></strong> |
            <% if venue.reviews.present? %>
              <% overall_rating = 0 %>
              <% venue.reviews.each do |review| %>
                <% overall_rating += review.rating %>
              <% end %>
              <% sum = overall_rating / venue.reviews.count.to_f %>
              <%= sum.round(1) %>⭐
              <% else %>
                No ratings
            <% end %>
             |
            <%= venue.size_of_band %> people</p>
          </div>
        </div>
      </div>
       <div class="col-2 "></div>
    <% end %>
  </div>
</div>
